version: 1.0.{build}
branches:
  only:
  - appveyor
skip_tags: true
image: Visual Studio 2017
configuration:
# - Debug
- Release
platform: x64
install:
  ############################################################################
  # All external dependencies are installed in C:\projects\deps
  ############################################################################
  - mkdir C:\deps
  - cd C:\deps
  
  ############################################################################
  # Set boost variables
  ############################################################################
  - set BOOST_ROOT=C:\Libraries\boost_1_64_0
  - set BOOST_LIBRARYDIR=C:\Libraries\boost_1_64_0\lib64-msvc-14.1

  ############################################################################
  # Install YAML-cpp
  ############################################################################
  - appveyor DownloadFile https://github.com/jbeder/yaml-cpp/archive/yaml-cpp-0.5.3.zip -FileName yaml-cpp-0.5.3.zip
  - 7z x yaml-cpp-0.5.3.zip -oC:\deps\yaml-cpp-0.5.3 > nul
  - set PATH=C:\deps\yaml-cpp-0.5.3;%PATH%
  - SET YAML-CPP_DIR=C:\deps\yaml-cpp-0.5.3
  
  ############################################################################
  # Install CGAL 4.8
  ############################################################################
  - appveyor DownloadFile https://github.com/CGAL/cgal/releases/download/releases/CGAL-4.8/CGAL-4.8.zip -FileName CGAL-4.8.zip
  - 7z x CGAL-4.8.zip -oC:\deps\CGAL-4.8 > nul
  - set PATH=C:\deps\CGAL-4.8;%PATH%
  - set CGAL_DIR=C:\deps\CGAL-4.8
  
  ############################################################################
  # Install OSGeo4W
  ############################################################################
  - appveyor DownloadFile http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe -FileName osgeo4w-setup-x86_64.exe
  - osgeo4w-setup-x86_64.exe --quiet-mode --upgrade-also --delete-orphans --no-desktop --advanced  --root C:\OSGeo4w --packages liblas-devel liblas laszip gdal --site http://download.osgeo.org/osgeo4w
  - set OSGEO4W_ROOT=C:\OSGeo4W
  - call %OSGEO4W_ROOT%\OSGeo4W.bat
  
  # ############################################################################
  # # Install GDAL 2.1.3
  # ############################################################################
  # - ps: mkdir C:\deps\gdal | out-null
  
  # - curl http://download.gisinternals.com/sdk/downloads/release-1800-x64-gdal-2-1-3-mapserver-7-0-4-20170202.zip --output gdalbin.zip
  # - 7z x gdalbin.zip -oC:\deps\gdal
  # - curl http://download.gisinternals.com/sdk/downloads/release-1800-x64-gdal-2-1-3-mapserver-7-0-4-20170202-libs.zip --output gdallibs.zip  
  # - 7z x gdallibs.zip -oC:\deps\gdal
  # - set PATH=C:\deps\gdal;C:\deps\gdal\bin;C:\deps\gdal\data;C:\deps\gdal\bin\gdal\apps;%PATH%
  # - set GDAL_DATA=C:\deps\gdal\bin\gdal-data
  
  - set
build:
  project: vs_build\3dfier.sln
  verbosity: minimal
# notifications:
# - provider: Email
  # to:
  # - t.j.f.commandeur@tudelft.nl
  # subject: Build new version of discretise-polygons
  # on_build_success: true
  # on_build_failure: true
  # on_build_status_changed: false